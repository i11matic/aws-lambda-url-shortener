<p align="center">
<a href="https://github.com/i11matic/aws-lambda-url-shortener/blob/master/LICENSE" title="License">
<img src="https://img.shields.io/github/license/i11matic/aws-lambda-url-shortener?label=License&logo=Github&style=flat-square" alt="<repo-title> License"/>
</a>
<a href="https://github.com/i11matic/aws-lambda-url-shortener/fork" title="Forks">
<img src="https://img.shields.io/github/forks/i11matic/aws-lambda-url-shortener?label=Forks&logo=Github&style=flat-square" alt="<repo-title> Forks"/>
</a>
<a href="https://github.com/i11matic/aws-lambda-url-shortener/stargazers" title="Stars">
<img src="https://img.shields.io/github/stars/i11matic/aws-lambda-url-shortener?label=Stars&logo=Github&style=flat-square" alt="<repo-title> Stars"/>
</a>
<a href="https://github.com/i11matic/aws-lambda-url-shortener/issues" title="Issues">
<img src="https://img.shields.io/github/issues/i11matic/aws-lambda-url-shortener?label=Issues&logo=Github&style=flat-square" alt="<repo-title> Issues"/>
</a>
<a href="https://github.com/i11matic/aws-lambda-url-shortener/pulls" title="Pull Requests">
<img src="https://img.shields.io/github/issues-pr/i11matic/aws-lambda-url-shortener?label=Pull%20Requests&logo=Github&style=flat-square" alt="<repo-title> Pull Requests"/>
</a>
<a href="https://github.com/i11matic/aws-lambda-url-shortener" title="Repo Size">
<img src="https://img.shields.io/github/repo-size/i11matic/aws-lambda-url-shortener?label=Repo%20Size&logo=Github&style=flat-square" alt="<repo-title> Repo Size"/>
</a>
<a href="https://open.vscode.dev/i11matic/aws-lambda-url-shortener" title="Open in VSCode">
<img src="https://img.shields.io/badge/Open%20in%20VSCode-%23007ACC?label=Code&logo=data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAPCAYAAAA71pVKAAAC00lEQVQYGX3BX2iVZRwH8O/ze//t/NkcRzdXmzZzLLYMmyVJUFQgzkQoqOsgAtNu6jK6kqjbIqOErrrTCBUUbBTYuZCMoDE0FZLp3DpnZ9s55313znmf/89TEV1JfT5s6uIG5LlvsPTdKViK8fCzr2H8wGEw1UIpNqgUYkRx38Bajqorb08ateWT62l+NrtxBSH+R0KAdhhbaelqp7X26MTTE9ix58UzG83u+7/l9Q9DEMHKHE4JoNiHf0UEKIvH1zh+lMZsC+ME3ZzDt4FiUtz75NE3viXvDYpbx44AHkjXwShAQIBx7PkGD37NtdsWBAzWGihtYD2QtXsQxkmienu+9MRzl3Yf++wylQaLulWHIXolU76qjI8DBmil0drkn/qocFkbCwsGrbQilXUUz3vo3/PS7PiJL38pPDL10eb68nllHQIiGGfxe231BI1MvlceHk2lyGG9h/UeoSzoZ0i507Kx8mYyMjHth3ZOiz9uIehs+F5x63xN0Tvh0Ni13dMz4Fw8ZJwHwPA30k0JsVF/26SNW7ybQQgBN/wY9OCOzsp89ZD44etro4NbkFQi5FwY4xmMB4wHSDY5XCc7bZr3pmy2CksRFO/CVMb7KzMH5yLbPXDv/CmkLQkqlENjPYwFjAUoSsTPNqRjtjwc5XcXbvZuXv3YxmWoTsrCkcl9Q299/pMqDR9fnDsDFoc14xms97Deg0yaxDpWkKwwl9XW9qulGx9Abr6qPQPP2jCSozJ7/IuuCz9p318aZFEC4wHjAdK9ZEaz3lGh9CxjcR4UBwDevmDT5Re0gxZSw0gBjEy+y7V72ToGbTwsi2JigYMz/hJjACP8I0xAqld1zTtPaa1aCgGMFHCMYB3ASgOwCBLCXxhjeEBYANP5dVe/vddysSh9ABcVgP4IPG8vNL7/6vUQ/8kDcR+YyFf04sIMje6q6t5msnrl6kmRpWf1/ev4E5Tbl9R3VUZRAAAAAElFTkSuQmCC&style=flat-square" alt="Open in VSCode"/>
</a>
<a href="https://github.dev/i11matic/aws-lambda-url-shortener" title="Open in VSCode Web">
<img src="https://img.shields.io/badge/Open%20in%20VSCode%20Web-%23007ACC?label=Code&logo=data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAPCAYAAAA71pVKAAAC00lEQVQYGX3BX2iVZRwH8O/ze//t/NkcRzdXmzZzLLYMmyVJUFQgzkQoqOsgAtNu6jK6kqjbIqOErrrTCBUUbBTYuZCMoDE0FZLp3DpnZ9s55313znmf/89TEV1JfT5s6uIG5LlvsPTdKViK8fCzr2H8wGEw1UIpNqgUYkRx38Bajqorb08ateWT62l+NrtxBSH+R0KAdhhbaelqp7X26MTTE9ix58UzG83u+7/l9Q9DEMHKHE4JoNiHf0UEKIvH1zh+lMZsC+ME3ZzDt4FiUtz75NE3viXvDYpbx44AHkjXwShAQIBx7PkGD37NtdsWBAzWGihtYD2QtXsQxkmienu+9MRzl3Yf++wylQaLulWHIXolU76qjI8DBmil0drkn/qocFkbCwsGrbQilXUUz3vo3/PS7PiJL38pPDL10eb68nllHQIiGGfxe231BI1MvlceHk2lyGG9h/UeoSzoZ0i507Kx8mYyMjHth3ZOiz9uIehs+F5x63xN0Tvh0Ni13dMz4Fw8ZJwHwPA30k0JsVF/26SNW7ybQQgBN/wY9OCOzsp89ZD44etro4NbkFQi5FwY4xmMB4wHSDY5XCc7bZr3pmy2CksRFO/CVMb7KzMH5yLbPXDv/CmkLQkqlENjPYwFjAUoSsTPNqRjtjwc5XcXbvZuXv3YxmWoTsrCkcl9Q299/pMqDR9fnDsDFoc14xms97Deg0yaxDpWkKwwl9XW9qulGx9Abr6qPQPP2jCSozJ7/IuuCz9p318aZFEC4wHjAdK9ZEaz3lGh9CxjcR4UBwDevmDT5Re0gxZSw0gBjEy+y7V72ToGbTwsi2JigYMz/hJjACP8I0xAqld1zTtPaa1aCgGMFHCMYB3ASgOwCBLCXxhjeEBYANP5dVe/vddysSh9ABcVgP4IPG8vNL7/6vUQ/8kDcR+YyFf04sIMje6q6t5msnrl6kmRpWf1/ev4E5Tbl9R3VUZRAAAAAElFTkSuQmCC&style=flat-square" alt="Open in VSCode Web"/>
</a>
</p>

# AWS Lambda URL Shortener

## Description

- This application is a URL shortener that is made for  AWS lambda, built in python
- This repo is only for the application code, and outputs a docker container
- [Deployment code via AWS CDK](https://github.com/i11matic/aws-cdk-url-shortener)
- [Deployment of required infrastructure via Terraform](https://github.com/i11matic/api-gateway-dynamodb-terraform)

## Table of Contents

- [AWS Lambda URL Shortener](#aws-lambda-url-shortener)
	- [Description](#description)
	- [Table of Contents](#table-of-contents)
	- [Prerequisites](#prerequisites)
	- [Installation](#installation)
	- [Local Development](#local-development)
		- [Examples](#examples)
	- [Architecture](#architecture)
	- [License](#license)


## Prerequisites
- [Python 3.9](https://www.python.org/downloads/release/python-390/)
- [Docker](https://docs.docker.com/get-docker/)
- [Pip](https://pip.pypa.io/en/stable/installation/)
- [Configured AWS Credentials](https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-files.html)


## Installation
**Note**: depending on how you installed *python* and *pip*, the commands may not need the *3* at the end.

```
python3 -m venv .venv
source .venv/bin/activate
pip3 install -r requirements.txaw
```
## Local Development

Building the Container

```
docker build . -t url-shortener
```

Start the local dynamodb Container
```
docker run -d amazon/dynamodb-local -p 8000:8000
```

Running the container
```
docker run --add-host=host.docker.internal:host-gateway \
--env DYNAMODB_ENDPOINT_URL="http://host.docker.internal:8000" \
--env AWS_ACCESS_KEY_ID=$AWS_ACCESS_KEY_ID \
--env AWS_SECRET_ACCESS_KEY=$AWS_SECRET_ACCESS_KEY \
--env AWS_DEFAULT_REGION=$AWS_DEFAULT_REGION -p 9000:8080  url-shortener
```

Local Developement Endpoint
```
http://localhost:9000/2015-03-31/functions/function/invocations
```

To create a short url the code reads the following fields, adjust these for your testing

```
{
	"requestContext": {
		"http": {
			"method": "POST"
		}
	},
	"body": "{\"url\": \"https://google.com\"}"
}

```

To get back the original URL the code reads the following fields, adjust these for your local testing
```
{
	"requestContext": {
		"http": {
			"method": "GET"
		}
	},
	"pathParameters": {
		"proxy": "DjWoSps"
	}
}
```
### Examples
![alt text](assets/images/local_get.png)
![alt text](assets/images/local_post.png)


## Architecture
- AWS API Gateway to provide REST endpoints for the lambda functions
- Lambda for execution of the runtime environment
  - Lambda for the URL shortener
  - Lambda Authorizer on */post* route for adminstrator functions (adding urls to the Dynamodb table)
  - provisioned concurrency enabled to allow parallel executions
  - ability to use account reserved concurrency
- Dynamodb for key/value storage of the short URLS and Original URLS
- Dynamodb Acelerator (DAX) for caching
- Route 53 to allow custom domain for the API gateway


![alt text](assets/images/arch_diagram.jpg)


## License

GNU General Public License v3.0
